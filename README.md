# 📢 西鎌倉住宅地自治会 BAND自動投稿システム 🤖✨

## 📝 概要
このシステムは、Gmailで受信した地域情報や西鎌倉のピンポイント天気予報を、Google Apps Script (GAS) を使って BAND 掲示板へ自動投稿する仕組みです。

ピーガルくん安全メールなどに特定の住所（腰越・深沢・片瀬地区）が含まれる場合は、自治会用の BAND へも自動で転送・マルチポストします。🚀

## 🌟 主な機能

### 1. 📧 メール自動転送機能
* **自動検知:** 鎌倉市、警察、運行情報（ジョルダン）からのメールをチェックします。
* **スマート加工:** 不要なフッター（解除案内など）をカットし、読みやすいヘッダーを付けて投稿します。
* **ハッシュタグ:** 内容に応じて `#防犯` や `#鉄道運行情報` を自動で付与します。📂
* **添付ファイル:** メールの画像も Google ドライブに保存し、URLを自動で記載します。📎

### 2. 🏠 条件付きマルチポスト（特定住所検知）
* 防犯メールの中に、あらかじめ設定した住所キーワードが含まれている場合のみ、転送先（自治会用）BAND にも同時投稿します。📍

### 3. ☀️ 天気予報投稿機能
* **ピンポイント予報:** 西鎌倉交差点付近の 3時間ごとの予報をお届けします。
* **見やすいレイアウト:** アイコンを使って、スマホ画面で表示が崩れない形式で出力します。🌤️

## 📂 ファイル構成
* `Main.gs`: メインの司令塔。メール解析やトリガー用の関数を記述。
* `Config.gs`: 設定の心臓部。トークン、住所リスト、ルールを管理。
* `BandHelper.gs`: BAND API や Google ドライブとの通信を担当。
* `Weather.gs`: 天気情報の取得と整形ロジック。
* `Announce.gs`: 管理者へのエラー通知メール送信。
* `Tool.gs`: セットアップ時に必要な `band_key` 確認用ツール。

## ⚙️ セットアップ手順

### 1. Config.gs の設定 🛠️
`Config.gs` を開き、以下の項目を確認・設定してください。
* `BAND_ACCESS_TOKEN`: APIトークン
* `TARGET_BAND_KEY`: メインの投稿先（周辺情報など）
* `EXTRA_BAND_KEY`: 転送先のキー（自治会用など）
* `IMAGE_FOLDER_ID`: ドライブのフォルダID
* `WATCH_ADDRESSES`: 転送対象にする住所リスト

### 2. トリガーの設定 ⏰
GASエディタの「トリガー（時計アイコン）」から、以下の 2つを設定してください。

| 実行する関数 | イベントのソース | 時間の間隔 / 時刻 | 備考 |
| :--- | :--- | :--- | :--- |
| `triggerGmailToBand` | 時間主導型 | 5分おき | メールの監視と投稿 📧 |
| `triggerWeather` | 時間主導型 | 06:00 〜 07:00 | 毎朝の天気予報投稿 ☀️ |

## ⚠️ 運用上の注意
* **投稿権限:** 使用するアカウントが各 BAND で「投稿権限」を持っている必要があります。🔑
* **ロック機構:** 処理が重なっても二重投稿されない安全設計（LockService）を採用しています。✅
